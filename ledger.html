<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>South Car Accessories</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <script>
/* üîê LOGIN GUARD ‚Äî BLOCK DIRECT ACCESS */
if (localStorage.getItem("sca_logged_in") !== "yes") {
  window.location.replace("login.html");
}
  </script>
  
<style>
:root{
  --bg:#f1f5f9;
  --card:#fff;
  --pri:#2563eb;
  --danger:#dc2626;
  --success:#16a34a;
  --text:#1f2937;
  --muted:#6b7280;
}

*{box-sizing:border-box}

body{
  margin:0;
  padding:90px 12px 14px;
  font-family:Segoe UI;
  background:var(--bg);
}

/* üîù TOP BAR */
.topbar{
  position:fixed;
  top:8px;
  left:50%;
  transform:translateX(-50%);
  width:calc(100% - 16px);
  max-width:100%;

  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 14px;

  background:linear-gradient(135deg,#2563eb,#1e40af);
  color:#fff;
  border-radius:14px;
  box-shadow:0 10px 25px rgba(0,0,0,.18);
  z-index:1000;
}

.topbar .brand{
  font-size:16px;
  font-weight:700;
  display:flex;
  align-items:center;
  gap:6px;
  white-space:nowrap;
}

.logout-btn{
  background:#ef4444;
  border:none;
  color:#fff;
  padding:7px 14px;
  border-radius:12px;
  font-weight:700;
  cursor:pointer;
}

/* CARDS */
.card{
  background:#fff;
  padding:16px;
  border-radius:16px;
  box-shadow:0 10px 25px rgba(0,0,0,.12);
  margin-bottom:16px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
  gap:12px;
}

input,textarea{
  width:100%;
  padding:10px;
  border-radius:12px;
  border:1px solid #d1d5db;
  font-size:14px;
}

button{
  padding:10px 14px;
  border:none;
  border-radius:12px;
  background:var(--pri);
  color:#fff;
  font-weight:600;
  cursor:pointer;
}

.btn-edit{background:#0ea5e9}
.btn-del{background:#dc2626}

/* TABLE */
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid #e5e7eb;font-size:12px}
th{background:#f8fafc;text-transform:uppercase}

/* üîî TOAST (SAFE FOR ALL DEVICES) */
.toast{
  position:fixed;
  left:50%;
  bottom:20px;
  transform:translateX(-50%);
  max-width:90%;
  padding:14px 20px;
  border-radius:16px;
  color:#fff;
  font-weight:600;
  text-align:center;
  display:none;
  z-index:3000;
  box-shadow:0 10px 25px rgba(0,0,0,.3);
}

.toast.success{background:var(--success)}
.toast.error{background:var(--danger)}

/* MOBILE */
@media(max-width:768px){
  body{padding-top:86px}
  .topbar{padding:9px 12px}
  .topbar .brand{font-size:15px}
}


  /* ========================= */
/* üì± MOBILE RESPONSIVENESS */
/* ========================= */

.summary{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
  gap:10px;
}

/* Make table scrollable on mobile */
.table-wrap{
  overflow-x:auto;
}

table{
  min-width:760px; /* keeps laptop look, allows scroll on mobile */
}

/* Touch friendly buttons */
button{
  min-height:42px;
}

/* Mobile-specific layout */
@media(max-width:768px){

  h2{
    font-size:18px;
  }

  marquee{
    font-size:13px;
  }

  .grid{
    grid-template-columns:1fr;
  }

  input, textarea{
    font-size:15px;
    padding:12px;
  }

  .summary{
    grid-template-columns:1fr 1fr;
  }

  .summary .card p{
    font-size:18px;
  }

  th, td{
    font-size:12px;
    padding:6px;
  }

  /* Hide less important columns on mobile */
  th:nth-child(7),
td:nth-child(7),
th:nth-child(10),
td:nth-child(10){
  display:none;
}

}

/* Extra small phones */
@media(max-width:420px){
  .summary{
    grid-template-columns:1fr;
  }

  .topbar .brand span{
    display:none; /* only üöó icon */
  }
}
.notice{
  text-align:center;
  font-weight:700;
  font-size:14px;
  color:#dc2626; /* red */
  margin:10px 0;
  animation: blink 1s infinite;
}

@keyframes blink{
  0%,100%{opacity:1}
  50%{opacity:0.2}
}
.blink-text{
  color:#dc2626;
  font-weight:700;
  font-size:14px;
  animation: blink 1s infinite;
}
/* üîπ CENTER ALIGN TABLE HEAD & DATA */
table th,
table td{
  text-align: center;
  vertical-align: middle;
}


</style>
</head>

<body>

<!-- üîì TOP BAR -->
<div class="topbar">
  <div class="brand">
    South Car Accessories
  </div>
  <button class="logout-btn" onclick="logout()">Logout</button>
</div>
  
<div class="notice">
  ‚ö†Ô∏è Enter Correct Data Here Daily
</div>
  <marquee class="blink-text">
   South Car Accessories and Spare Parts | Anantnag
</marquee>


<!-- üîç DATE RANGE FILTER -->
<div class="card">
<div class="grid">
<input type="date" id="fromDate">
<input type="date" id="toDate">
<button onclick="applyRange()">Apply Filter</button>
<button onclick="clearRange()">Clear Filter</button>
</div>
</div>

<!-- üìä SUMMARY CARDS -->
<div class="summary">
<div class="card"><h4>üíµ Cash Offline</h4><p id="cOff">‚Çπ0</p></div>
<div class="card"><h4>üí≥ Cash Online</h4><p id="cOn">‚Çπ0</p></div>
<div class="card"><h4>üí∞ Total Credit</h4><p id="cCredit">‚Çπ0</p></div>
<div class="card"><h4>üìâ Total Debit</h4><p id="cDebit">‚Çπ0</p></div>
<div class="card"><h4>üìà Profit</h4><p id="cProfit">‚Çπ0</p></div>
<div class="card"><h4>üè¶ Balance</h4><p id="cBalance">‚Çπ0</p></div>
</div>

<!-- ‚ûï ADD ENTRY -->
<div class="card">
<h3>‚ûï Add Entry</h3>
<div class="grid">
<input type="date" id="date">
<input placeholder="Item name" id="item">
<input type="number" placeholder="Quantity" id="qty">
<input type="number" placeholder="Cost price" id="cost">
<input type="number" placeholder="Selling price" id="sell">
<input type="number" placeholder="Cash Offline" id="cashOff">
<input type="number" placeholder="Cash Online" id="cashOn">
</div>
<br>
<textarea id="desc" placeholder="Description"></textarea>
<br><br>
<button onclick="save()">üíæ Save Entry</button>
</div>

<!-- üìã TABLE -->
<div class="card table-wrap">
<table>
<thead>
<tr>
<th>#</th>
<th>Date</th>
<th>Item</th>
<th>Qty</th>
<th>Description</th>
<th>Offline</th>
<th>Online</th>
<th>Debit</th>
<th>Credit</th>
<th>Profit</th>
<th>Action</th>
</tr>
</thead>

<tbody id="tbody"></tbody>
</table>

<div class="pagination">
<button onclick="prevPage()">‚¨Ö Prev</button>
<span id="pageInfo"></span>
<button onclick="nextPage()">Next ‚û°</button>
</div>
</div>

<div class="toast" id="toast"></div>
  
<script>


const URL="https://script.google.com/macros/s/AKfycbx-b6qM9NZslNYBk3LXqj7wrvKOERmXtXtWkwxALmZE9JPpnObg7nUdmG33Qufb9Z5w/exec";

let all=[],view=[],page=1,perPage=10;

function toastMsg(msg,type="success"){
  const t = document.getElementById("toast");
  t.innerText = msg;
  t.className = "toast " + type;
  t.style.display = "block";

  clearTimeout(window.toastTimer);
  window.toastTimer = setTimeout(()=>{
    t.style.display="none";
  },2200);
}



function save(){
if(!date.value||!item.value||!qty.value||!cost.value||!sell.value||!desc.value){
toastMsg("All fields required","error");return;
}

const fd=new FormData();
fd.append("action","add");
fd.append("date",date.value);
fd.append("item",item.value);
fd.append("qty",qty.value);
fd.append("cost",cost.value);
fd.append("sell",sell.value);
fd.append("cashOff",cashOff.value||0);
fd.append("cashOn",cashOn.value||0);
fd.append("debit",qty.value*cost.value);
fd.append("credit",(+cashOff.value||0)+(+cashOn.value||0));
fd.append("profit",(sell.value-cost.value)*qty.value);
fd.append("desc",desc.value);

fetch(URL,{method:"POST",mode:"no-cors",body:fd});
toastMsg("Data saved ‚Äì South Car Accessories üíæ");
document.querySelectorAll("input,textarea").forEach(i=>i.value="");
load();
}

function load(){
  fetch(URL)
    .then(r => r.json())
    .then(d => {
      all = d.sort((a,b) => new Date(b.date) - new Date(a.date)); // NEWEST FIRST
      view = [...all];
      page = 1;
      render();
      calcCards();
    });
}


function applyRange(){
const f=new Date(fromDate.value);
const t=new Date(toDate.value);
view=all.filter(r=>{
const d=new Date(r.date);
return (!fromDate.value||d>=f)&&(!toDate.value||d<=t);
});
page=1;
render();
calcCards();
}

function clearRange(){
fromDate.value="";toDate.value="";
view=[...all];
page=1;
render();
calcCards();
}

function calcCards(){
let off=0,on=0,deb=0,cre=0,pro=0;
view.forEach(r=>{
off+=+r.cashOff;on+=+r.cashOn;
deb+=+r.debit;cre+=+r.credit;pro+=+r.profit;
});
cOff.innerText="‚Çπ"+off;
cOn.innerText="‚Çπ"+on;
cDebit.innerText="‚Çπ"+deb;
cCredit.innerText="‚Çπ"+cre;
cProfit.innerText="‚Çπ"+pro;
cBalance.innerText="‚Çπ"+(cre-deb);
}

function render(){
  tbody.innerHTML="";
  const start=(page-1)*perPage;

  view.slice(start,start+perPage).forEach((r,i)=>{
    tbody.innerHTML+=`
    <tr>
      <td>${start+i+1}</td>
      <td>${formatDateDMY(r.date)}</td>
      <td>${r.item}</td>
      <td>${r.qty}</td>

      <!-- ‚úÖ DESCRIPTION -->
      <td style="max-width:220px;white-space:normal;word-break:break-word;">
        ${r.desc || ""}
      </td>

      <td>${r.cashOff}</td>
      <td>${r.cashOn}</td>
      <td>${r.debit}</td>
      <td>${r.credit}</td>
      <td>${r.profit}</td>
      <td>
        <button class="btn-edit" onclick="openEdit(${start+i})">‚úèÔ∏è</button>
        <button class="btn-del" onclick="openDelete(${start+i})">üóëÔ∏è</button>
      </td>
    </tr>`;
  });

  pageInfo.innerText=`Page ${page} / ${Math.ceil(view.length/perPage)||1}`;
}


function nextPage(){if(page*perPage<view.length){page++;render();}}
function prevPage(){if(page>1){page--;render();}}

load();





let editIndex = null;
let deleteIndex = null;

/* ---------- EDIT ---------- */
function openEdit(i){
  editIndex = i;
  const r = view[i];

  eDate.value = r.date;
  eItem.value = r.item;
  eQty.value = r.qty;
  eCost.value = r.cost;
  eSell.value = r.sell;
  eOff.value = r.cashOff;
  eOn.value = r.cashOn;
  eDesc.value = r.desc;

  document.getElementById("editOverlay").style.display = "flex";
}

function closeEdit(){
  document.getElementById("editOverlay").style.display = "none";
}

function updateEntry(){
  const r = view[editIndex];

  r.date = eDate.value;
  r.item = eItem.value;
  r.qty = +eQty.value;
  r.cost = +eCost.value;
  r.sell = +eSell.value;
  r.cashOff = +eOff.value || 0;
  r.cashOn = +eOn.value || 0;
  r.debit = r.qty * r.cost;
  r.credit = r.cashOff + r.cashOn;
  r.profit = (r.sell - r.cost) * r.qty;
  r.desc = eDesc.value;

  render();
  calcCards();
  closeEdit();
  toastMsg("‚úèÔ∏è Entry updated successfully");
}

/* ---------- DELETE ---------- */
function openDelete(i){
  deleteIndex = i;
  document.getElementById("delOverlay").style.display = "flex";
}

function closeDelete(){
  document.getElementById("delOverlay").style.display = "none";
}

function confirmDelete(){
  const record = view[deleteIndex];

  all = all.filter(r => r !== record);
  view.splice(deleteIndex,1);

  render();
  calcCards();
  closeDelete();
  toastMsg("üóëÔ∏è Entry deleted successfully");
}

function logout(){
  if(!confirm("Do you want to logout?")) return;

  // clear session
  localStorage.clear();
  sessionStorage.clear();

  // redirect to login page
  window.location.href = "login.html";
}
function formatDateDMY(d){
  if(!d) return "";
  const date = new Date(d);
  if(isNaN(date)) return d;

  const dd = String(date.getDate()).padStart(2,"0");
  const mm = String(date.getMonth()+1).padStart(2,"0");
  const yyyy = date.getFullYear();

  return `${dd}-${mm}-${yyyy}`;
}

  /* ===============================
   AUTO LOGOUT ON INACTIVITY
================================ */

let inactivityTimer;
const INACTIVITY_LIMIT = 10 * 60 * 1000; // 10 minutes

function resetInactivityTimer(){
  clearTimeout(inactivityTimer);
  inactivityTimer = setTimeout(autoLogout, INACTIVITY_LIMIT);
}

function autoLogout(){
  alert("Session expired due to inactivity");
  logout();
}

// Detect user activity
["click","mousemove","keydown","scroll","touchstart"].forEach(evt => {
  document.addEventListener(evt, resetInactivityTimer, true);
});

// Start timer on page load
resetInactivityTimer();

</script>

</body>
</html>






















