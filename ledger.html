<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>South Car Accessories</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#f1f5f9;
  --card:#fff;
  --pri:#2563eb;
  --danger:#dc2626;
  --success:#16a34a;
  --text:#1f2937;
  --muted:#6b7280;
}

*{box-sizing:border-box}

body{
  margin:0;
  padding:90px 12px 14px;
  font-family:Segoe UI;
  background:var(--bg);
}

/* ğŸ” TOP BAR */
.topbar{
  position:fixed;
  top:8px;
  left:50%;
  transform:translateX(-50%);
  width:calc(100% - 16px);
  max-width:100%;

  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:10px 14px;

  background:linear-gradient(135deg,#2563eb,#1e40af);
  color:#fff;
  border-radius:14px;
  box-shadow:0 10px 25px rgba(0,0,0,.18);
  z-index:1000;
}

.topbar .brand{
  font-size:16px;
  font-weight:700;
  display:flex;
  align-items:center;
  gap:6px;
  white-space:nowrap;
}

.logout-btn{
  background:#ef4444;
  border:none;
  color:#fff;
  padding:7px 14px;
  border-radius:12px;
  font-weight:700;
  cursor:pointer;
}

/* CARDS */
.card{
  background:#fff;
  padding:16px;
  border-radius:16px;
  box-shadow:0 10px 25px rgba(0,0,0,.12);
  margin-bottom:16px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
  gap:12px;
}

input,textarea{
  width:100%;
  padding:10px;
  border-radius:12px;
  border:1px solid #d1d5db;
  font-size:14px;
}

button{
  padding:10px 14px;
  border:none;
  border-radius:12px;
  background:var(--pri);
  color:#fff;
  font-weight:600;
  cursor:pointer;
}

.btn-edit{background:#0ea5e9}
.btn-del{background:#dc2626}

/* TABLE */
table{width:100%;border-collapse:collapse}
th,td{padding:8px;border-bottom:1px solid #e5e7eb;font-size:12px}
th{background:#f8fafc;text-transform:uppercase}

/* ğŸ”” TOAST (SAFE FOR ALL DEVICES) */
.toast{
  position:fixed;
  left:50%;
  bottom:20px;
  transform:translateX(-50%);
  max-width:90%;
  padding:14px 20px;
  border-radius:16px;
  color:#fff;
  font-weight:600;
  text-align:center;
  display:none;
  z-index:3000;
  box-shadow:0 10px 25px rgba(0,0,0,.3);
}

.toast.success{background:var(--success)}
.toast.error{background:var(--danger)}

/* MOBILE */
@media(max-width:768px){
  body{padding-top:86px}
  .topbar{padding:9px 12px}
  .topbar .brand{font-size:15px}
}


</style>
</head>

<body>

<!-- ğŸ”“ TOP BAR -->
<div class="topbar">
  <div class="brand">
    ğŸš— <span>South Car Accessories</span>
  </div>
  <button class="logout-btn" onclick="logout()">Logout</button>
</div>

  
<h2> South Car Accessories</h2>
<marquee>Enter Correct Data Here</marquee>
<!-- ğŸ” DATE RANGE FILTER -->
<div class="card">
<div class="grid">
<input type="date" id="fromDate">
<input type="date" id="toDate">
<button onclick="applyRange()">Apply Filter</button>
<button onclick="clearRange()">Clear Filter</button>
</div>
</div>

<!-- ğŸ“Š SUMMARY CARDS -->
<div class="summary">
<div class="card"><h4>ğŸ’µ Cash Offline</h4><p id="cOff">â‚¹0</p></div>
<div class="card"><h4>ğŸ’³ Cash Online</h4><p id="cOn">â‚¹0</p></div>
<div class="card"><h4>ğŸ’° Total Credit</h4><p id="cCredit">â‚¹0</p></div>
<div class="card"><h4>ğŸ“‰ Total Debit</h4><p id="cDebit">â‚¹0</p></div>
<div class="card"><h4>ğŸ“ˆ Profit</h4><p id="cProfit">â‚¹0</p></div>
<div class="card"><h4>ğŸ¦ Balance</h4><p id="cBalance">â‚¹0</p></div>
</div>

<!-- â• ADD ENTRY -->
<div class="card">
<h3>â• Add Entry</h3>
<div class="grid">
<input type="date" id="date">
<input placeholder="Item name" id="item">
<input type="number" placeholder="Quantity" id="qty">
<input type="number" placeholder="Cost price" id="cost">
<input type="number" placeholder="Selling price" id="sell">
<input type="number" placeholder="Cash Offline" id="cashOff">
<input type="number" placeholder="Cash Online" id="cashOn">
</div>
<br>
<textarea id="desc" placeholder="Description"></textarea>
<br><br>
<button onclick="save()">ğŸ’¾ Save Entry</button>
</div>

<!-- ğŸ“‹ TABLE -->
<div class="card">
<table>
<thead>
<tr>
<th>#</th><th>Date</th><th>Item</th><th>Qty</th>
<th>Offline</th><th>Online</th>
<th>Debit</th><th>Credit</th><th>Profit</th><th>Action</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<div class="pagination">
<button onclick="prevPage()">â¬… Prev</button>
<span id="pageInfo"></span>
<button onclick="nextPage()">Next â¡</button>
</div>
</div>

<div class="toast" id="toast"></div>

<script>
const URL="https://script.google.com/macros/s/AKfycbwCqMgIE7bI5FGrp2oZtTnR3dq1Xn2dkWAQSRjaWGnPqewApNkumHPPtv2iXXogrBm5/exec";

let all=[],view=[],page=1,perPage=10;

function toastMsg(msg,type="success"){
  const t = document.getElementById("toast");
  t.innerText = msg;
  t.className = "toast " + type;
  t.style.display = "block";

  clearTimeout(window.toastTimer);
  window.toastTimer = setTimeout(()=>{
    t.style.display="none";
  },2200);
}



function save(){
if(!date.value||!item.value||!qty.value||!cost.value||!sell.value||!desc.value){
toastMsg("All fields required","error");return;
}

const fd=new FormData();
fd.append("action","add");
fd.append("date",date.value);
fd.append("item",item.value);
fd.append("qty",qty.value);
fd.append("cost",cost.value);
fd.append("sell",sell.value);
fd.append("cashOff",cashOff.value||0);
fd.append("cashOn",cashOn.value||0);
fd.append("debit",qty.value*cost.value);
fd.append("credit",(+cashOff.value||0)+(+cashOn.value||0));
fd.append("profit",(sell.value-cost.value)*qty.value);
fd.append("desc",desc.value);

fetch(URL,{method:"POST",mode:"no-cors",body:fd});
toastMsg("Data saved â€“ South Car Accessories ğŸ’¾");
document.querySelectorAll("input,textarea").forEach(i=>i.value="");
load();
}

function load(){
fetch(URL).then(r=>r.json()).then(d=>{
all=d.reverse();
view=[...all];
page=1;
render();
calcCards();
});
}

function applyRange(){
const f=new Date(fromDate.value);
const t=new Date(toDate.value);
view=all.filter(r=>{
const d=new Date(r.date);
return (!fromDate.value||d>=f)&&(!toDate.value||d<=t);
});
page=1;
render();
calcCards();
}

function clearRange(){
fromDate.value="";toDate.value="";
view=[...all];
page=1;
render();
calcCards();
}

function calcCards(){
let off=0,on=0,deb=0,cre=0,pro=0;
view.forEach(r=>{
off+=+r.cashOff;on+=+r.cashOn;
deb+=+r.debit;cre+=+r.credit;pro+=+r.profit;
});
cOff.innerText="â‚¹"+off;
cOn.innerText="â‚¹"+on;
cDebit.innerText="â‚¹"+deb;
cCredit.innerText="â‚¹"+cre;
cProfit.innerText="â‚¹"+pro;
cBalance.innerText="â‚¹"+(cre-deb);
}

function render(){
tbody.innerHTML="";
const start=(page-1)*perPage;
view.slice(start,start+perPage).forEach((r,i)=>{
tbody.innerHTML+=`
<tr>
<td>${start+i+1}</td>
<td>${r.date}</td><td>${r.item}</td><td>${r.qty}</td>
<td>${r.cashOff}</td><td>${r.cashOn}</td>
<td>${r.debit}</td><td>${r.credit}</td><td>${r.profit}</td>
<td>
<button class="btn-edit" onclick="openEdit(${start+i})">âœï¸</button>
<button class="btn-del" onclick="openDelete(${start+i})">ğŸ—‘ï¸</button>

</td>
</tr>`;
});
pageInfo.innerText=`Page ${page} / ${Math.ceil(view.length/perPage)||1}`;
}

function nextPage(){if(page*perPage<view.length){page++;render();}}
function prevPage(){if(page>1){page--;render();}}

load();





let editIndex = null;
let deleteIndex = null;

/* ---------- EDIT ---------- */
function openEdit(i){
  editIndex = i;
  const r = view[i];

  eDate.value = r.date;
  eItem.value = r.item;
  eQty.value = r.qty;
  eCost.value = r.cost;
  eSell.value = r.sell;
  eOff.value = r.cashOff;
  eOn.value = r.cashOn;
  eDesc.value = r.desc;

  document.getElementById("editOverlay").style.display = "flex";
}

function closeEdit(){
  document.getElementById("editOverlay").style.display = "none";
}

function updateEntry(){
  const r = view[editIndex];

  r.date = eDate.value;
  r.item = eItem.value;
  r.qty = +eQty.value;
  r.cost = +eCost.value;
  r.sell = +eSell.value;
  r.cashOff = +eOff.value || 0;
  r.cashOn = +eOn.value || 0;
  r.debit = r.qty * r.cost;
  r.credit = r.cashOff + r.cashOn;
  r.profit = (r.sell - r.cost) * r.qty;
  r.desc = eDesc.value;

  render();
  calcCards();
  closeEdit();
  toastMsg("âœï¸ Entry updated successfully");
}

/* ---------- DELETE ---------- */
function openDelete(i){
  deleteIndex = i;
  document.getElementById("delOverlay").style.display = "flex";
}

function closeDelete(){
  document.getElementById("delOverlay").style.display = "none";
}

function confirmDelete(){
  const record = view[deleteIndex];

  all = all.filter(r => r !== record);
  view.splice(deleteIndex,1);

  render();
  calcCards();
  closeDelete();
  toastMsg("ğŸ—‘ï¸ Entry deleted successfully");
}

function logout(){
  if(!confirm("Do you want to logout?")) return;

  // clear session
  localStorage.clear();
  sessionStorage.clear();

  // redirect to login page
  window.location.href = "login.html";
}


  
</script>

</body>
</html>










